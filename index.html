<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario DFSK - Repuestos Glory</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 95%; margin: 0 auto; background: white; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; }
        .header { background: #2c3e50; color: white; padding: 25px; text-align: center; }
        .header h1 { font-size: 2.2em; margin-bottom: 8px; }
        .last-update { background: #34495e; padding: 10px; text-align: center; color: #ecf0f1; font-size: 0.9em; }
        .controls { padding: 20px; background: #f8f9fa; border-bottom: 1px solid #e9ecef; display: flex; gap: 15px; align-items: center; flex-wrap: wrap; }
        .search-box { flex: 1; min-width: 250px; padding: 12px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; }
        .stock-filter { padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px; background: white; }
        .inventory-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .inventory-table th { background: #34495e; color: white; padding: 12px 8px; text-align: left; font-weight: 600; font-size: 11px; position: sticky; top: 0; }
        .inventory-table td { padding: 10px 8px; border-bottom: 1px solid #ecf0f1; font-size: 11px; line-height: 1.3; }
        .inventory-table tr:hover { background: #f8f9fa; }
        .stock-high { background: #d4edda; color: #155724; font-weight: bold; padding: 4px 8px; border-radius: 4px; text-align: center; }
        .stock-medium { background: #fff3cd; color: #856404; font-weight: bold; padding: 4px 8px; border-radius: 4px; text-align: center; }
        .stock-low { background: #f8d7da; color: #721c24; font-weight: bold; padding: 4px 8px; border-radius: 4px; text-align: center; }
        .stock-zero { background: #f1f1f1; color: #6c757d; font-weight: bold; padding: 4px 8px; border-radius: 4px; text-align: center; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .footer { text-align: center; padding: 15px; background: #ecf0f1; color: #7f8c8d; font-size: 12px; }
        .error { text-align: center; padding: 40px; color: #e74c3c; background: #f8d7da; margin: 20px; border-radius: 8px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè≠ Inventario DFSK - Serie Glory</h1>
            <p>Stock de repuestos disponible - Actualizaci√≥n autom√°tica</p>
        </div>
        
        <div class="last-update">
            √öltima actualizaci√≥n: <span id="update-time">Cargando...</span>
        </div>
        
        <div class="controls">
            <input type="text" class="search-box" placeholder="üîç Buscar por c√≥digo, descripci√≥n, n√∫mero de parte..." id="searchInput">
            <select class="stock-filter" id="stockFilter">
                <option value="all">Todo el stock</option>
                <option value="high">Stock Alto (>10)</option>
                <option value="medium">Stock Medio (1-10)</option>
                <option value="low">Stock Bajo (0)</option>
            </select>
        </div>
        
        <div style="overflow-x: auto; max-height: 70vh; overflow-y: auto;">
            <div id="loading-message" class="loading">üîÑ Cargando inventario...</div>
            <div id="error-message" class="error" style="display: none;"></div>
            <table class="inventory-table" id="inventory-table" style="display: none;">
                <thead>
                    <tr>
                        <th>CODIGO</th>
                        <th>MARCA</th>
                        <th>SERIE</th>
                        <th>MODELO</th>
                        <th>NUMERO DE PARTE</th>
                        <th>DESCRIPCION ESPA√ëOL</th>
                        <th>CANTIDAD</th>
                    </tr>
                </thead>
                <tbody id="inventory-body"></tbody>
            </table>
        </div>
        
        <div class="footer">
            <p>&copy; 2024 Sistema de Inventario DFSK - Actualizaci√≥n autom√°tica</p>
        </div>
    </div>

    <script>
        // URL SIMPLIFICADA - Esto deber√≠a funcionar
        const CSV_URL = './inventario.csv';
        
        let inventoryData = [];

        function getStockStatus(cantidad) {
            if (cantidad > 10) return { text: "Alto", class: "stock-high" };
            if (cantidad > 0) return { text: "Medio", class: "stock-medium" };
            return { text: "Agotado", class: "stock-zero" };
        }

        function renderInventory(data) {
            const tbody = document.getElementById('inventory-body');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 20px; color: #666;">No se encontraron repuestos</td></tr>';
                return;
            }
            
            tbody.innerHTML = data.map(item => {
                const status = getStockStatus(item.cantidad);
                return `
                    <tr>
                        <td><strong>${item.codigo}</strong></td>
                        <td>${item.marca}</td>
                        <td>${item.serie}</td>
                        <td>${item.modelo}</td>
                        <td>${item.numero_parte}</td>
                        <td>${item.descripcion}</td>
                        <td><span class="${status.class}">${item.cantidad}</span></td>
                    </tr>
                `;
            }).join('');
        }

        function filterInventory() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const stockFilter = document.getElementById('stockFilter').value;
            
            const filteredData = inventoryData.filter(item => {
                const matchesSearch = 
                    (item.codigo && item.codigo.toLowerCase().includes(searchTerm)) ||
                    (item.descripcion && item.descripcion.toLowerCase().includes(searchTerm)) ||
                    (item.numero_parte && item.numero_parte.toLowerCase().includes(searchTerm)) ||
                    (item.modelo && item.modelo.toLowerCase().includes(searchTerm));
                
                let matchesStock = true;
                if (stockFilter === "high") matchesStock = item.cantidad > 10;
                else if (stockFilter === "medium") matchesStock = item.cantidad > 0 && item.cantidad <= 10;
                else if (stockFilter === "low") matchesStock = item.cantidad === 0;
                
                return matchesSearch && matchesStock;
            });
            
            renderInventory(filteredData);
        }

function csvToJSON(csv) {
    const lines = csv.split('\n').filter(line => line.trim() !== '');
    if (lines.length < 2) return [];
    
    const result = [];
    const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/ /g, '_'));
    
    console.log('Columnas detectadas:', headers); // Para debug
    
    for (let i = 1; i < lines.length; i++) {
        const obj = {};
        const currentline = lines[i].split(',');
        
        for (let j = 0; j < headers.length; j++) {
            const key = headers[j];
            let value = currentline[j] ? currentline[j].trim() : '';
            
            // Convertir cantidad a n√∫mero
            if (key === 'cantidad') {
                value = parseInt(value) || 0;
            }
            
            // Mapear nombres de columnas espec√≠ficos
            if (key === 'descripcion_espanol') {
                obj['descripcion'] = value;
            } else {
                obj[key] = value;
            }
        }
        
        if (obj.codigo) {
            result.push(obj);
        }
    }
    
    return result;
}
        async function loadInventory() {
            try {
                document.getElementById('loading-message').style.display = 'block';
                document.getElementById('error-message').style.display = 'none';
                document.getElementById('inventory-table').style.display = 'none';
                
                const response = await fetch(CSV_URL + '?t=' + new Date().getTime());
                
                if (!response.ok) throw new Error('No se pudo cargar el archivo CSV');
                
                const csvData = await response.text();
                
                if (!csvData || csvData.trim() === '') {
                    throw new Error('El archivo CSV est√° vac√≠o');
                }
                
                inventoryData = csvToJSON(csvData);
                
                if (inventoryData.length === 0) {
                    throw new Error('Formato CSV incorrecto');
                }
                
                document.getElementById('loading-message').style.display = 'none';
                document.getElementById('inventory-table').style.display = 'table';
                renderInventory(inventoryData);
                document.getElementById('update-time').textContent = new Date().toLocaleString();
                
            } catch (error) {
                document.getElementById('loading-message').style.display = 'none';
                document.getElementById('error-message').style.display = 'block';
                document.getElementById('error-message').innerHTML = 
                    '‚ùå Error: ' + error.message + 
                    '<br><br>Verifica que el archivo "inventario.csv" exista y tenga datos.';
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadInventory();
            document.getElementById('searchInput').addEventListener('input', filterInventory);
            document.getElementById('stockFilter').addEventListener('change', filterInventory);
        });
    </script>
</body>
</html>
